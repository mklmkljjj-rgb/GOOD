# 러닝 일지 + Garmin OCR 자동입력 + RPG 성장 웹앱

> iOS/Swift 개발은 중단했고, 현재 저장소의 메인은 브라우저에서 실행하는 정적 웹앱입니다.

## 파일 구조
- `index.html`: 메인 메뉴 기반 섹션 전환 UI + OCR 디버그/후보 선택 패널
- `styles.css`: 네온/글래스모피즘 테마 + 메뉴/디버그/후보 UI 스타일
- `index.html`: 전체 UI + OCR 디버그/후보 선택 패널
- `styles.css`: 기본 스타일 + 디버그 패널/썸네일/후보 UI 스타일
- `app.js`: OpenCV 전처리/ROI 검출 + Tesseract OCR 앙상블 + 파싱/스코어링/저장/분석 로직
- `README.md`: 사용법

## 주요 기능
1. **이번 달 요약**
   - 총 거리, 총 시간, 평균 페이스, 훈련 횟수
   - 레벨/누적 EXP/레벨 진행도
   - 최근 30일 평균 페이스/평균 심박
2. **Garmin OCR 자동입력 (강화 파이프라인)**
   - 이미지 업로드 → OpenCV 전처리 파이프라인 다중 생성
   - ROI(하단 카드/큰 패널) 자동 검출 후 ROI 우선 OCR
   - Tesseract 다중 설정(언어/PSM) 앙상블
   - 상태바 시각/배터리/네트워크 등 상단 노이즈를 ROI/마스킹/파싱 단계에서 강하게 무시
   - 상태바 시각/상단 메뉴 노이즈를 낮은 점수로 처리
   - 거리/시간/페이스/평균심박/칼로리 후보 생성 후 조합 최적화
3. **디버그/보정 UX**
   - 디버그 토글: ROI 박스, 전처리 썸네일, 후보 점수/선택 근거 표시
   - 필드별 후보 드롭다운 수동 선택
   - “보정 템플릿 삽입” 버튼으로 수동 보정 포맷 자동 생성
   - 샘플 OCR 텍스트 3종 주입 버튼(상태바/다크/라이트 케이스)
4. **수동 입력 + 기록 저장**
   - 날짜, 거리, 시간, 심박, 칼로리, 메모
   - 훈련유형 자동분류(또는 수동 지정)
5. **기록 리스트 관리**
   - 정렬(최신/날짜/거리/페이스/EXP)
   - 수정/삭제
6. **RPG 진행 시스템 (퀘스트 없음)**
   - EXP: 1km=10 + 강도/효율/회복 보정 - 과훈련 패널티
   - 레벨업 필요 EXP 점증
   - 스탯(지구력/스피드/회복력/일관성) 0~100 + Lv.1~10
   - 최근 패턴 기반 빌드 요약 문구
7. **목표 월 마일리지 기반 자동 훈련 계획**
   - 현재 월 km / 목표 월 km / 주간 증가율(5~10%) / 컷백 주기(3~4주) 입력
   - 안전 증가율 기반 주차별 km 자동 생성 + 컷백 주 자동 삽입
   - 강도 분배 규칙 자동 적용(고강도 ≤20%, 롱런 ≤30%, 존2 중심)
   - 주차별 목표 km vs 실제 km 진행률 표 + 구조 요약 카드 제공
7. **월간 훈련 계획**
   - 주 5~6회 기반 템플릿 자동 생성
   - 캘린더형 리스트 + 완료 체크
   - 보너스 EXP 없음(일관성 분석에만 반영)
8. **데이터 관리**
   - localStorage 자동 저장
   - JSON 내보내기/가져오기
   - CSV 내보내기
   - localStorage 초기화

## OCR 파이프라인 상세
앱은 업로드 이미지를 다음 단계로 처리합니다.

1. **리사이즈**: 긴 변을 약 1900px 기준으로 보정(저해상도는 업스케일)
2. **대비 향상**: CLAHE 적용
3. **노이즈 제거**: bilateral filter
4. **이진화**: adaptiveThreshold + 반전 버전 생성
5. **형태학 보정**: 작은 커널로 close/open
6. **ROI 검출**: Canny + contour로 큰 사각형 후보 탐지(하단 영역 우선)
7. **OCR 앙상블**: 파이프라인/ROI/PSM/언어 조합 중 최고 점수 선택
8. **파싱 앙상블**: 라벨 근접도 + 범위 + 조합 일관성(time-distance-pace)로 최종 선택

## 실행 방법
### 1) 가장 간단한 실행 (더블클릭)
- `index.html` 파일을 더블클릭해서 브라우저로 엽니다.
- 대부분 기능은 동작합니다.

### 2) OCR 문제 시 로컬 서버 실행 (권장)
일부 브라우저/보안정책에서 `file://` 환경의 CDN/OCR 로딩이 제한될 수 있습니다.

```bash
python -m http.server 8000
```

이후 브라우저에서 아래 주소 열기:
- `http://localhost:8000`

## 첫 로딩 안내
- Tesseract.js는 초기 실행 시 OCR 언어 모델(`eng+kor` 우선, 실패 시 `eng`)을 다운로드합니다.
- 네트워크/브라우저 캐시에 따라 첫 OCR 시작이 느릴 수 있습니다.

## Garmin 스크린샷 인식 팁
- 이제 전체 스크린샷 그대로 업로드해도 ROI 자동 검출로 동작하도록 개선되어 있습니다.
- 그래도 인식이 애매하면 디버그 모드에서 후보 점수를 확인하고 드롭다운으로 직접 선택하세요.
- 최종적으로 실패 시 “보정 템플릿 삽입”을 눌러 숫자만 채워 저장하세요.

## 저장/복원
- 새로고침해도 데이터는 `localStorage`에 유지됩니다.
- PC 교체/백업 시 JSON 내보내기 사용

## 문제 해결
- OCR 버튼 눌러도 시작 안 됨:
  - 인터넷 연결 확인(CDN 로딩 필요)
  - `python -m http.server`로 열기
- 파싱 누락 발생:
  - OCR 텍스트 직접 수정 후 재파싱
  - 디버그 모드에서 후보 선택 변경
- 데이터가 꼬였을 때:
  - JSON 백업 후 localStorage 초기화
